@if (event()){
<div class="wrapper">
  @if (payment) {
  @if (currency === 'VND') {
  <img class="qr" src="assets/qr.png" alt="QR">
  <button class="buy-button" (click)="downloadQR()">
    Сохранить QR
  </button>
  <div class="instruction">
    Оплатите {{ totalVND() }}k VND и отправьте скриншот квитанции.
  </div>
  } @else if(currency === 'RUB') {
  <div class="instruction">
    Оплатите {{ totalRub() }} ₽ по номеру
  </div>
  <div class="instruction phone" (click)="copyPhone()">{{ phone }}</div>
  <div class="instruction">
    на Т-банк или Сбербанк и отправьте скриншот квитанции.
  </div>
  } @else {

  <div class="instruction">
    Оплатите {{ totalUSDT() }} USDT на:
  </div>
  <div class="instruction phone" (click)="copyTON()"> TON кошелек</div>
  <div class="instruction phone" (click)="copyTRC20()"> TRC20 кошелек</div>
  <div class="instruction">
    и отправьте скриншот квитанции.
  </div>
  }
  <input type="file" accept="image/*" (change)="onFileSelected($event)" hidden #fileInput>
  <button class="buy-button" (click)="fileInput.click()">
    Отправить квитанцию
  </button>
  <button class="buy-button" (click)="cancelPayment()">
    Назад
  </button>
  } @else if (showInfo) {
  <div class="instruction">
    Спасибо за покупку! Ваш платеж обрабатывается. После подтверждения оплаты, бот отправит вам билеты в телеграм. Если
    у вас возникнут вопросы, напишите в чат с ботом.
  </div>
  <button class="buy-button" (click)="myTickets()">
    Мои билеты
  </button>
  <button class="buy-button" (click)="back()">
    На главную страницу
  </button>
  } @else {

  <div class="timing">
    <div> {{event().date}}</div>
    <div> {{event().start}}</div>
  </div>
  <div class="place">
    @if(place()){
    {{ place().name }}
    <a class="ticket-map" [href]="place()?.map" target="_blank">
      Открыть на карте
    </a>
    }
  </div>
  <div class="schema">
    @if (!imageLoaded()) {
    <div class="schema-loader">
      <div class="gold-spinner"></div>
    </div>
    }

    <img class="schema-image" [class.hidden]="!imageLoaded()" [src]="event().schema" alt="Схема зала"
      (load)="onImageLoad()" (error)="onImageError()">
  </div>

  @if (otherEvents().length > 0) {
  <div class="combo-block">
    <div class="combo-title">
      Купи билеты на 2-е шоу c 20% скидкой!
    </div>

    <div class="combo-events">
      @for (event of otherEvents(); track event.id) {
      <div class="combo-item" [class.selected]="selectedOtherEvent()?.id === event.id"
        (click)="selectOtherEvent(event)">

        <div class="combo-checkbox">
          <div class="checkmark" *ngIf="selectedOtherEvent()?.id === event.id">
          </div>
        </div>

        <div class="combo-info">
          <div class="combo-type">
            {{ event.type === 0 ? 'СТЕНДАП-КОНЦЕРТ' : 'СТЕНДАП-НЕТВОРКИНГ' }}
          </div>

          <div class="combo-date">
            {{ event.date }} {{ event.start }}
            <span class="combo-place">
              {{
              stateService.placesMap().get(event.place)?.name
              }}
            </span>
          </div>

        </div>

      </div>

      }
    </div>
  </div>
  }

  <div class="tickets-wrapper">
    <div class="currency-switch">
      <button class="segment" [class.active]="currency === 'VND'" (click)="currency = 'VND'">
        VND
      </button>

      <button class="segment" [class.active]="currency === 'RUB'" (click)="currency = 'RUB'">
        Руб
      </button>

      <button class="segment" [class.active]="currency === 'USDT'" (click)="currency = 'USDT'">
        USDT
      </button>
    </div>
    <div class="ticket-card" *ngFor="let ticket of tickets()">

      <div class="ticket-info">
        <div class="ticket-title">
          {{ ticketNames[ticket.type] }}
          @if(selectedOtherEvent()) {
          <span class="ticket-add">
            (на два шоу)
          </span>
          }
        </div>
        <div class="ticket-prices">
          @switch (currency) {
          @case ('VND') {
          {{ ticket.priceVND * (selectedOtherEvent() ? 1.8 : 1) }}k VND
          }
          @case ('RUB') {
          {{ ticket.priceRub * (selectedOtherEvent() ? 1.8 : 1) }} ₽
          }
          @case ('USDT') {
          {{ ticket.priceUSDT * (selectedOtherEvent() ? 1.8 : 1) }} USDT
          }
          }

        </div>

        <div class="ticket-add">
          {{ ticket.add }}
        </div>
      </div>

      <div class="ticket-controls">
        <button class="control-btn" (click)="decrease(ticket)" [disabled]="getCount(ticket.type) === 0">
          −
        </button>

        <div class="ticket-count">
          {{ getCount(ticket.type) }}
        </div>

        <button class="control-btn" (click)="increase(ticket)">
          +
        </button>
      </div>

    </div>
  </div>

  <button class="buy-button" (click)="buyTickets()" [disabled]="state().length === 0">
    @switch (currency) {
    @case ('VND') {
    Купить за {{ totalVND() }}k VND
    }
    @case ('RUB') {
    Купить за {{ totalRub() }} ₽
    }
    @case ('USDT') {
    Купить за {{ totalUSDT() }} USDT
    }
    }
  </button>
  <button class="buy-button" (click)="back()">
    Назад
  </button>
  }
</div>

}
